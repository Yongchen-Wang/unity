# robot_data_logger æ·»åŠ ç‹¬ç«‹æ—¶é—´æˆ³ - ä½¿ç”¨è¯´æ˜

## ğŸ“ ä¿®æ”¹æ€»ç»“

**æ–‡ä»¶**: `robot_data_logger_with_timestamps.py` (ä¿®æ”¹åçš„ç‰ˆæœ¬)

**ä¿®æ”¹ä½ç½®**: åªä¿®æ”¹äº† **4ä¸ªåœ°æ–¹**ï¼Œæ€»å…±çº¦ **20è¡Œä»£ç **

### ä¿®æ”¹è¯¦æƒ…

#### 1. __init__ æ–¹æ³• (ç¬¬107è¡Œé™„è¿‘)
```python
# æ·»åŠ 3ä¸ªæ—¶é—´æˆ³å˜é‡
self.camera_timestamp = None        # æ‘„åƒå¤´æ•°æ®æ—¶é—´æˆ³
self.geomagic_timestamp = None      # Geomagicå·®å€¼æ•°æ®æ—¶é—´æˆ³
self.fsr_timestamp = None           # FSRæ•°æ®æ—¶é—´æˆ³
```

#### 2. start_recording æ–¹æ³• (ç¬¬243-265è¡Œ)
```python
# CSVè¡¨å¤´æ·»åŠ 4ä¸ªæ—¶é—´æˆ³åˆ—
'timestamp_camera',      # â­ æ‘„åƒå¤´æ•°æ®æ—¶é—´æˆ³
'timestamp_fsr',         # â­ FSRæ•°æ®æ—¶é—´æˆ³
'timestamp_geomagic',    # â­ Geomagicå·®å€¼æ•°æ®æ—¶é—´æˆ³
'timestamp_velocity'     # â­ Geomagicé€Ÿåº¦æ•°æ®æ—¶é—´æˆ³
```

#### 3. record_data æ–¹æ³• (ç¬¬439-460è¡Œ)
```python
# CSVå†™å…¥æ—¶åŒ…å«ç‹¬ç«‹æ—¶é—´æˆ³
f"{self.camera_timestamp:.6f}" if self.camera_timestamp is not None else "",
f"{self.fsr_timestamp:.6f}" if self.fsr_timestamp is not None else "",
f"{self.geomagic_timestamp:.6f}" if self.geomagic_timestamp is not None else "",
f"{self.velocity_timestamp:.6f}" if self.velocity_timestamp is not None else ""
```

#### 4. æ•°æ®æ¥æ”¶æ—¶æ›´æ–°æ—¶é—´æˆ³
```python
# 4a. _process_tcp_data (ç¬¬683è¡Œ)
self.camera_timestamp = current_time  # æ‘„åƒå¤´æ•°æ®åˆ°è¾¾æ—¶

# 4b. _fsr_read_loop (ç¬¬523è¡Œ)
self.fsr_timestamp = time.time()  # FSRæ•°æ®åˆ°è¾¾æ—¶

# 4c. start_error_server (ç¬¬850è¡Œ)
self.geomagic_timestamp = time.time()  # Geomagicæ•°æ®åˆ°è¾¾æ—¶
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ­¥éª¤1: æ›¿æ¢æ–‡ä»¶

```bash
# å¤‡ä»½åŸæ–‡ä»¶
cp robot_data_logger.py robot_data_logger_backup.py

# ä½¿ç”¨æ–°æ–‡ä»¶
cp robot_data_logger_with_timestamps.py robot_data_logger.py
```

### æ­¥éª¤2: æ­£å¸¸è¿è¡Œ

```bash
# å¯åŠ¨æ•°æ®è®°å½•å™¨ï¼ˆä¸ä¹‹å‰å®Œå…¨ç›¸åŒï¼‰
python robot_data_logger.py
```

### æ­¥éª¤3: æ£€æŸ¥æ–°CSVæ ¼å¼

è®°å½•çš„CSVæ–‡ä»¶ç°åœ¨åŒ…å«4ä¸ªé¢å¤–çš„æ—¶é—´æˆ³åˆ—ï¼š

```csv
timestamp,time_elapsed,position_x,position_y,velocity_x,velocity_y,velocity_magnitude,distance_to_boundary,timestamp_camera,fsr_analog,fsr_digital,timestamp_fsr,error_x_L,error_y_L,error_x_R,error_y_R,timestamp_geomagic,geomagic_velocity_x_L,geomagic_velocity_y_L,geomagic_velocity_x_R,geomagic_velocity_y_R,timestamp_velocity
```

**ç¤ºä¾‹æ•°æ®è¡Œ:**
```csv
1765717009.573980,0.364403,8.418919,-7.926107,0.157227,-0.530525,0.553333,0.758674,1765717009.573980,,,,-1.944966,-4.180051,1765717009.473980,-1.813923,-1.152167,1765717009.473980
                                                                                      â†‘æ‘„åƒå¤´æ—¶é—´æˆ³                    â†‘Geomagicæ—¶é—´æˆ³               â†‘é€Ÿåº¦æ—¶é—´æˆ³
```

---

## ğŸ“Š æ•°æ®åˆ†æ

### ä½¿ç”¨align_data.pyåˆ†æå’Œå¯¹é½

```bash
# 1. åˆ†ææ•°æ®è´¨é‡
python align_data.py robot_data_20251214_125649.py

# è¾“å‡º:
# - å„æ•°æ®æºé‡‡æ ·ç‡
# - æ•°æ®æ–°é²œåº¦ç»Ÿè®¡
# - å¼‚å¸¸å€¼æ£€æµ‹
# - timestamp_analysis.png (å¯è§†åŒ–)
# - data_quality_report.txt (è¯¦ç»†æŠ¥å‘Š)

# 2. å¯¹é½æ•°æ®åˆ°50Hz
python align_data.py robot_data_20251214_125649.csv --rate 50

# è¾“å‡º:
# - robot_data_20251214_125649_aligned_50Hz.csv

# 3. å¯¹é½åˆ°100Hzç”¨äºæœºå™¨å­¦ä¹ 
python align_data.py robot_data_20251214_125649.csv --rate 100 --method cubic
```

---

## ğŸ” éªŒè¯ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆ

### æ–¹æ³•1: æ£€æŸ¥CSVè¡¨å¤´

```python
import pandas as pd

df = pd.read_csv('robot_data/robot_data_20251214_125649.csv')
print(df.columns.tolist())

# åº”è¯¥çœ‹åˆ°:
# ['timestamp', 'time_elapsed', ..., 'timestamp_camera', ..., 
#  'timestamp_fsr', ..., 'timestamp_geomagic', ..., 'timestamp_velocity']
```

### æ–¹æ³•2: æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦æœ‰å€¼

```python
import pandas as pd

df = pd.read_csv('robot_data/robot_data_20251214_125649.csv')

# æ£€æŸ¥æ‘„åƒå¤´æ—¶é—´æˆ³
print(f"Camera timestamps: {df['timestamp_camera'].notna().sum()} / {len(df)}")

# æ£€æŸ¥Geomagicæ—¶é—´æˆ³
print(f"Geomagic timestamps: {df['timestamp_geomagic'].notna().sum()} / {len(df)}")

# æ£€æŸ¥FSRæ—¶é—´æˆ³ï¼ˆå¦‚æœFSRå·²è¿æ¥ï¼‰
print(f"FSR timestamps: {df['timestamp_fsr'].notna().sum()} / {len(df)}")

# åº”è¯¥çœ‹åˆ°:
# Camera timestamps: 348 / 348  (æ‰€æœ‰è¡Œéƒ½æœ‰)
# Geomagic timestamps: 112 / 348  (çº¦1/3ï¼Œå› ä¸º10Hz vs 30Hz)
# FSR timestamps: 0 / 348  (æœªè¿æ¥åˆ™ä¸º0)
```

### æ–¹æ³•3: è®¡ç®—æ•°æ®å»¶è¿Ÿ

```python
import pandas as pd

df = pd.read_csv('robot_data/robot_data_20251214_125649.csv')

# è®¡ç®—Geomagicæ•°æ®å»¶è¿Ÿ
df['geomagic_delay'] = (df['timestamp'] - df['timestamp_geomagic']) * 1000  # ms

print(f"Geomagicå¹³å‡å»¶è¿Ÿ: {df['geomagic_delay'].mean():.1f} ms")
print(f"Geomagicæœ€å¤§å»¶è¿Ÿ: {df['geomagic_delay'].max():.1f} ms")

# åº”è¯¥çœ‹åˆ°åˆç†çš„å»¶è¿Ÿå€¼ (é€šå¸¸<100ms)
```

---

## âœ… å…¼å®¹æ€§

### å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… ä¸éœ€è¦ä¿®æ”¹å…¶ä»–æ–‡ä»¶ï¼ˆcamera, geomagic_controlç­‰ï¼‰
- âœ… start_both_programs.py ä»ç„¶æ­£å¸¸å·¥ä½œ

### æ•°æ®æ ¼å¼å˜åŒ–
- âš ï¸ CSVåˆ—æ•°ä»18åˆ—å¢åŠ åˆ°22åˆ—
- âš ï¸ æ—§çš„åˆ†æè„šæœ¬å¯èƒ½éœ€è¦è°ƒæ•´ï¼ˆå¦‚æœå®ƒä»¬ä¾èµ–åˆ—ç´¢å¼•ï¼‰
- âœ… ä½¿ç”¨åˆ—åè®¿é—®çš„ä»£ç ä¸å—å½±å“

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: CSVæ²¡æœ‰æ—¶é—´æˆ³åˆ—

**æ£€æŸ¥**:
```bash
head -1 robot_data/robot_data_*.csv
```

**å¦‚æœçœ‹ä¸åˆ° `timestamp_camera` ç­‰åˆ—**:
- ç¡®è®¤ä½¿ç”¨çš„æ˜¯ä¿®æ”¹åçš„æ–‡ä»¶
- é‡æ–°å¯åŠ¨ robot_data_logger.py

### é—®é¢˜2: æ—¶é—´æˆ³åˆ—å…¨æ˜¯ç©ºçš„

**å¯èƒ½åŸå› **:
- æ•°æ®æºæœªè¿æ¥ï¼ˆä¾‹å¦‚FSRæœªè¿æ¥ï¼Œtimestamp_fsrä¸ºç©ºæ˜¯æ­£å¸¸çš„ï¼‰
- æ£€æŸ¥å¯¹åº”çš„æ•°æ®æºæ˜¯å¦åœ¨å‘é€æ•°æ®

**æ£€æŸ¥æ‘„åƒå¤´æ—¶é—´æˆ³**:
```python
df = pd.read_csv('robot_data.csv')
print(df['timestamp_camera'].describe())
# åº”è¯¥æœ‰count > 0
```

### é—®é¢˜3: æ—¶é—´æˆ³çœ‹èµ·æ¥ä¸åˆç†

**éªŒè¯æ—¶é—´æˆ³**:
```python
import pandas as pd
import time

df = pd.read_csv('robot_data.csv')

# æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
now = time.time()
diff = now - df['timestamp'].max()

print(f"æœ€æ–°æ•°æ®è·ç°åœ¨: {diff/3600:.1f} å°æ—¶å‰")
# åº”è¯¥æ˜¯æœ€è¿‘çš„æ—¶é—´

# æ£€æŸ¥æ—¶é—´æˆ³å·®å€¼
dt = df['timestamp'].diff()
print(f"å¹³å‡é‡‡æ ·é—´éš”: {dt.mean()*1000:.1f} ms")
# åº”è¯¥çº¦ä¸º33ms (30Hz) æˆ–ç›¸åº”çš„é¢‘ç‡
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

1. **robot_data_logger_with_timestamps.py** - ä¿®æ”¹åçš„æ•°æ®è®°å½•å™¨
2. **robot_data_logger_patch_guide.py** - è¯¦ç»†ä¿®æ”¹è¯´æ˜
3. **align_data.py** - æ•°æ®å¯¹é½å’Œåˆ†æå·¥å…·
4. **å¤šæºå¼‚æ­¥æ•°æ®æ—¶é—´æˆ³åŒæ­¥æ–¹æ¡ˆ.md** - å®Œæ•´æ–¹æ¡ˆæ–‡æ¡£

---

## ğŸ’¡ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œä¸€æ¬¡æµ‹è¯•å®éªŒï¼ŒéªŒè¯CSVæ ¼å¼æ­£ç¡®
2. âœ… ä½¿ç”¨ `align_data.py` æ£€æŸ¥æ•°æ®è´¨é‡
3. âœ… å¯¹é½æ•°æ®ç”¨äºåç»­åˆ†æ
4. ğŸš€ å¼€å§‹ä½ çš„RGCN+Transformeræ¨¡å‹è®­ç»ƒï¼

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜:
1. æ£€æŸ¥CSVè¡¨å¤´æ˜¯å¦åŒ…å«4ä¸ªæ–°æ—¶é—´æˆ³åˆ—
2. æ£€æŸ¥æ—¶é—´æˆ³åˆ—æ˜¯å¦æœ‰å€¼ï¼ˆéå…¨ç©ºï¼‰
3. è¿è¡Œ `align_data.py` ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š
4. æŸ¥çœ‹ `data_quality_report.txt` äº†è§£è¯¦ç»†ä¿¡æ¯

**ä¿®æ”¹å¾ˆç®€å•ï¼Œå½±å“å¾ˆå°ï¼Œä½†æ•ˆæœæ˜¾è‘—ï¼** ğŸ‰
